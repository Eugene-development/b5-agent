# –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π SSR

## –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –°–±–æ—Ä–∫–∞ production build
npm run build

# –ó–∞–ø—É—Å–∫ production —Å–µ—Ä–≤–µ—Ä–∞
npm run preview
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/finances` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/dashboard` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤

**–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- [ ] `src/routes/(protected)/finances/+page.server.js`
- [ ] `src/routes/(protected)/dashboard/+page.server.js`
- [ ] `docs/FINANCES_SSR_FIX.md`
- [ ] `docs/TESTING_FINANCES_SSR.md`
- [ ] `docs/SSR_MIGRATION_SUMMARY.md`
- [ ] `docs/DEPLOYMENT_CHECKLIST.md`

**–£–¥–∞–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- [ ] `src/routes/(protected)/finances/+page.js` (—É–¥–∞–ª–µ–Ω)
- [ ] `src/routes/(protected)/dashboard/+page.js` (—É–¥–∞–ª–µ–Ω)

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- [ ] `src/routes/(protected)/finances/+page.svelte`
- [ ] `src/routes/(protected)/dashboard/+page.svelte`

### 3. Git –∫–æ–º–º–∏—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
git status

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
git add src/routes/(protected)/finances/
git add src/routes/(protected)/dashboard/
git add b5-agent/docs/

# –ö–æ–º–º–∏—Ç
git commit -m "fix: SSR –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü /finances –∏ /dashboard

- –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π load –¥–ª—è /finances –∏ /dashboard
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"

# –ü—É—à
git push origin main
```

## –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh user@server
cd /path/to/b5-agent
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
git pull origin main

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
git log -1
git diff HEAD~1 HEAD --stat
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
npm install
```

### 4. –°–±–æ—Ä–∫–∞

```bash
# Production build
npm run build
```

### 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è PM2:**
```bash
pm2 restart b5-agent
pm2 logs b5-agent --lines 50
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker:**
```bash
docker-compose down
docker-compose up -d --build
docker-compose logs -f b5-agent
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è systemd:**
```bash
sudo systemctl restart b5-agent
sudo journalctl -u b5-agent -f
```

## –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/finances`:**
```
üöÄ Finances SSR: Starting server-side load
üë§ Finances SSR: Loading data for user: user@example.com
üí∞ Finances SSR: Starting data load
‚úÖ Finances SSR: Loaded data in XXXms
```

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/dashboard`:**
```
üöÄ Dashboard SSR: Starting server-side load
üë§ Dashboard SSR: Loading stats for user: user@example.com
üìä Dashboard SSR: Starting data load for user: XXX
‚úÖ Dashboard SSR: Loaded stats in XXXms
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

#### –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/finances`

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://agent.bonus5.ru/finances
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Network
3. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π HTML –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ HTML —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –æ –±–æ–Ω—É—Å–∞—Ö

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—É–º–º—ã
- [ ] –¢–∞–±–ª–∏—Ü–∞ –±–æ–Ω—É—Å–æ–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏
- [ ] –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø–∏—Å–∏
- [ ] –ù–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ `/login`
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

#### –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/dashboard`

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://agent.bonus5.ru/dashboard
2. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Network
3. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π HTML –∑–∞–ø—Ä–æ—Å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ HTML —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á–∏—Å–ª–∞
- [ ] –ù–µ—Ç skeleton loader –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
- [ ] –ù–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –Ω–∞ `/login`
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ httpOnly cookie

DevTools ‚Üí Application ‚Üí Cookies ‚Üí `https://agent.bonus5.ru`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] Cookie `b5_auth_token` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] HttpOnly: ‚úì
- [ ] Secure: ‚úì
- [ ] SameSite: Lax –∏–ª–∏ Strict
- [ ] Domain: `.bonus5.ru` –∏–ª–∏ `agent.bonus5.ru`

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤

DevTools ‚Üí Network ‚Üí —Ñ–∏–ª—å—Ç—Ä "graphql"

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- [ ] –ó–∞–ø—Ä–æ—Å—ã —Å–æ–¥–µ—Ä–∂–∞—Ç `Authorization: Bearer <token>`
- [ ] –û—Ç–≤–µ—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ (–Ω–µ –ø—É—Å—Ç—ã–µ)
- [ ] Status: 200 OK
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ GraphQL

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
1. –í—ã–π–¥–∏—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
2. –í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
3. –û—Ç–∫—Ä–æ–π—Ç–µ `/finances` –∏ `/dashboard`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/finances`
2. –ù–∞–∂–º–∏—Ç–µ Ctrl+Shift+R (hard reload)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–∞–≤–∏–≥–∞—Ü–∏—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/dashboard`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/finances`
3. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ `/dashboard`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

**Performance:**
- Time to First Byte (TTFB): < 1s
- First Contentful Paint (FCP): < 2s
- –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: < 500ms

**Errors:**
- –û—à–∏–±–∫–∏ 401 Unauthorized: 0
- –û—à–∏–±–∫–∏ GraphQL: 0
- JavaScript errors: 0

**Logs:**
- –£—Å–ø–µ—à–Ω—ã–µ SSR –∑–∞–≥—Ä—É–∑–∫–∏: 100%
- Fallback –Ω–∞ –∫–ª–∏–µ–Ω—Ç: < 5%

## Rollback –ø–ª–∞–Ω

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. –ë—ã—Å—Ç—Ä—ã–π rollback —á–µ—Ä–µ–∑ Git

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /path/to/b5-agent
git revert HEAD
npm run build
pm2 restart b5-agent
```

### 2. Rollback –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É

```bash
git reset --hard HEAD~1
git push origin main --force
# –ó–∞—Ç–µ–º –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
```

### 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å +page.js –¥–ª—è finances
git checkout HEAD~1 -- src/routes/(protected)/finances/+page.js

# –£–¥–∞–ª–∏—Ç—å +page.server.js
rm src/routes/(protected)/finances/+page.server.js

# –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è dashboard
git checkout HEAD~1 -- src/routes/(protected)/dashboard/+page.js
rm src/routes/(protected)/dashboard/+page.server.js

# –°–±–æ—Ä–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
npm run build
pm2 restart b5-agent
```

## –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ httpOnly cookie
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CORS
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ 401

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `hooks.server.js`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ JWT –Ω–∞ backend

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤
2. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã (–¥–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã)
3. –î–æ–±–∞–≤—å—Ç–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `docs/`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ `/projects`

## –ß–µ–∫–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

- [ ] –ö–æ–¥ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
- [ ] –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü—ã `/finances` –∏ `/dashboard` —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] httpOnly cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] GraphQL –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –≤ –Ω–æ—Ä–º–µ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ö–æ–º–∞–Ω–¥–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
