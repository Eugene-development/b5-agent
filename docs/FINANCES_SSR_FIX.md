# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSR –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ñ–∏–Ω–∞–Ω—Å–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/finances` –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–∞—Ö, —Ö–æ—Ç—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ dev —Ä–µ–∂–∏–º–µ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–ª–æ.

## –ü—Ä–∏—á–∏–Ω–∞

–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π `+page.js` –≤–º–µ—Å—Ç–æ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ `+page.server.js`. –ü—Ä–∏ SSR (Server-Side Rendering) –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:

1. –ö–æ–¥ `+page.js` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ `localStorage`, –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è JWT —Ç–æ–∫–µ–Ω
3. HTTP-–∫–ª–∏–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å `Authorization: Bearer <token>` –∑–∞–≥–æ–ª–æ–≤–æ–∫
4. GraphQL –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –æ—à–∏–±–∫—É 401

–õ–æ–∫–∞–ª—å–Ω–æ –≤ dev —Ä–µ–∂–∏–º–µ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –ø—Ä–æ—è–≤–ª—è–ª–∞—Å—å, —Ç–∞–∫ –∫–∞–∫:
- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è (–±–µ–∑ –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏)
- Dev —Å–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –≤–µ—Å—Ç–∏ —Å–µ–±—è –∏–Ω–∞—á–µ –ø—Ä–∏ SSR

## –†–µ—à–µ–Ω–∏–µ

### 1. –°–æ–∑–¥–∞–Ω —Å–µ—Ä–≤–µ—Ä–Ω—ã–π load function

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `b5-agent/src/routes/(protected)/finances/+page.server.js`:

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç JWT —Ç–æ–∫–µ–Ω –∏–∑ `locals.token` (httpOnly cookie)
- –í—ã–ø–æ–ª–Ω—è–µ—Ç GraphQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç streaming –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è skeleton
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ —Å –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–µ–π

### 2. –£–¥–∞–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π load function

–£–¥–∞–ª–µ–Ω —Ñ–∞–π–ª `b5-agent/src/routes/(protected)/finances/+page.js`, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π load –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

### 3. –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–í `+page.svelte` –¥–æ–±–∞–≤–ª–µ–Ω–æ:

- `$effect()` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- `onMount()` —Å fallback –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É (–µ—Å–ª–∏ –Ω–µ—Ç httpOnly cookie)
- –§–ª–∞–≥ `needsClientLoad` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
- Skeleton loader –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö

### 4. –°–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Skeleton

–°–æ–∑–¥–∞–Ω `FinancesPageSkeleton.svelte`:

- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç skeleton –¥–ª—è —Ç–∞–±–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç skeleton –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- –£–ª—É—á—à–∞–µ—Ç –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –°–µ—Ä–≤–µ—Ä–Ω—ã–π load function

```javascript
export async function load({ locals, fetch, depends }) {
  depends('finances');
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ httpOnly cookie
  if (!locals?.user || !locals?.token) {
    return {
      // ... –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
      needsClientLoad: true
    };
  }
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å JWT —Ç–æ–∫–µ–Ω–æ–º –∏–∑ locals
  return loadFinancesData(locals.token, fetch);
}
```

### GraphQL –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É—Ç–∏–ª–∏—Ç–∞ `makeServerGraphQLRequest` –∏–∑ `$lib/api/server.js`:

```javascript
await makeServerGraphQLRequest(
  token,           // JWT –∏–∑ locals.token
  query,           // GraphQL –∑–∞–ø—Ä–æ—Å
  variables,       // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  fetch            // SvelteKit fetch –¥–ª—è SSR
);
```

### Fallback –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É

–ï—Å–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ—Ç httpOnly cookie (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ localStorage):

```javascript
onMount(async () => {
  if (needsClientLoad) {
    await loadAllData(); // –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ client-side API
  }
});
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **SSR —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
2. **–ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
3. **SEO-friendly** - –∫–æ–Ω—Ç–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–∏—Å–∫–æ–≤—ã–º —Å–∏—Å—Ç–µ–º–∞–º
4. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ httpOnly cookie
5. **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/projects`

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –ù–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/finances` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å SSR HTML —Å –¥–∞–Ω–Ω—ã–º–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è:
   - –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å —Å—É–º–º–∞–º–∏
   - –¢–∞–±–ª–∏—Ü–∞ –±–æ–Ω—É—Å–æ–≤
   - –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç

### –í –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞

–î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –ª–æ–≥–∏:

```
üöÄ Finances SSR: Starting server-side load
üë§ Finances SSR: Loading data for user: user@example.com
üí∞ Finances SSR: Starting data load
‚úÖ Finances SSR: Loaded data in XXXms
```

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `b5-agent/src/routes/(protected)/finances/+page.server.js` - —Å–µ—Ä–≤–µ—Ä–Ω—ã–π load
- `b5-agent/src/routes/(protected)/finances/+page.svelte` - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `b5-agent/src/lib/components/finances/FinancesPageSkeleton.svelte` - skeleton loader
- `b5-agent/src/lib/api/server.js` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è SSR
- `b5-agent/src/lib/api/finances.js` - API –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤

## –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–°–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–∞–∫–æ–π –∂–µ –ø–æ–¥—Ö–æ–¥:

- `/projects` - `+page.server.js` —Å SSR
- `/dashboard` - –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü —Å –¥–∞–Ω–Ω—ã–º–∏:

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `+page.server.js` –≤–º–µ—Å—Ç–æ `+page.js`
2. –ü–æ–ª—É—á–∞–π—Ç–µ JWT —Ç–æ–∫–µ–Ω –∏–∑ `locals.token`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `makeServerGraphQLRequest` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
4. –î–æ–±–∞–≤–ª—è–π—Ç–µ fallback –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É
5. –õ–æ–≥–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
