# Инструкция по тестированию отображения бонусов

## Цель тестирования

Проверить корректность отображения бонусов агента и куратора в модальном окне просмотра проекта.

## Предварительные требования

1. Запущен backend (b5-api-2)
2. Запущен frontend (b5-agent)
3. Есть авторизованный пользователь-агент
4. В системе есть проекты с договорами и/или закупками

## Шаги тестирования

### 1. Открыть страницу проектов

```
URL: http://localhost:5173/projects
```

### 2. Открыть модальное окно проекта

- Кликните на любой проект в таблице
- Должно открыться модальное окно с деталями проекта

### 3. Проверить раздел "Итого бонусов"

Должны отображаться:
- ✅ Бонус агента (сумма в рублях)
- ✅ Премия агенту (сумма в рублях)

### 4. Проверить раздел "Бонусы по договорам"

Для каждого договора должны отображаться:

| Поле | Ожидаемое значение |
|------|-------------------|
| Номер договора | Номер или "Договор без номера" |
| Сумма договора | Сумма в рублях (например, "1 000 000 ₽") |
| % агента | Процент (например, "3%" или "3% (по умолчанию)") |
| Бонус агента | Рассчитанная сумма в рублях (зеленым цветом если активен) |
| Премия агенту | Рассчитанная сумма в рублях (голубым цветом если активен) |

#### Проверка дефолтных значений

Если процент агента не задан явно:
- Должно отображаться "3% (по умолчанию)"
- Бонус должен быть рассчитан как 3% от суммы договора

### 5. Проверить раздел "Бонусы по закупкам"

Для каждой закупки должны отображаться:

| Поле | Ожидаемое значение |
|------|-------------------|
| Номер закупки | Номер или "Закупка без номера" |
| Сумма закупки | Сумма в рублях |
| % агента | Процент (например, "5%" или "5% (по умолчанию)") |
| Бонус агента | Рассчитанная сумма в рублях |
| Премия агенту | Рассчитанная сумма в рублях |

#### Проверка дефолтных значений

Если процент агента не задан явно:
- Должно отображаться "5% (по умолчанию)"
- Бонус должен быть рассчитан как 5% от суммы закупки

### 6. Проверить неактивные договоры/закупки

Для неактивных элементов:
- Должна быть метка "Неактивен" / "Неактивна"
- Бонусы должны отображаться серым цветом
- Бонусы должны быть равны 0 ₽

## Примеры расчетов

### Договор с дефолтным процентом

```
Сумма договора: 1 000 000 ₽
% агента: 3% (по умолчанию)
Бонус агента: 30 000 ₽
```

### Договор с кастомным процентом

```
Сумма договора: 1 000 000 ₽
% агента: 5%
Бонус агента: 50 000 ₽
```

### Закупка с дефолтным процентом

```
Сумма закупки: 500 000 ₽
% агента: 5% (по умолчанию)
Бонус агента: 25 000 ₽
```

## Возможные проблемы и решения

### Проблема: Не отображается процент агента

**Решение:**
1. Проверьте, что backend возвращает данные с дефолтными значениями
2. Проверьте консоль браузера на наличие ошибок
3. Убедитесь, что GraphQL запрос включает поле `agent_percentage`

### Проблема: Бонус равен 0 при наличии суммы

**Возможные причины:**
1. Договор/закупка неактивны (`is_active = false`)
2. Сумма равна 0 или null
3. Процент равен 0

### Проблема: Не отображается пометка "(по умолчанию)"

**Решение:**
Проверьте, что в компоненте `BonusDetailsSection.svelte` есть условие:
```svelte
{#if !contract.agent_percentage}
  <span class="text-xs text-gray-500">(по умолчанию)</span>
{/if}
```

## Контрольный список

- [ ] Открывается модальное окно проекта
- [ ] Отображается раздел "Итого бонусов"
- [ ] Отображаются суммы бонусов агента и куратора
- [ ] Отображается раздел "Бонусы по договорам" (если есть договоры)
- [ ] Для каждого договора показаны все поля
- [ ] Процент агента отображается корректно (с дефолтом 3%)
- [ ] Бонус агента рассчитан правильно
- [ ] Отображается раздел "Бонусы по закупкам" (если есть закупки)
- [ ] Для каждой закупки показаны все поля
- [ ] Процент агента отображается корректно (с дефолтом 5%)
- [ ] Неактивные элементы помечены и отображаются серым
- [ ] Суммы форматируются в рублях с правильными разделителями

## Дополнительная информация

- Дефолтные проценты задаются в `BonusCalculationService.php`
- Отображение реализовано в `BonusDetailsSection.svelte`
- GraphQL запрос находится в `projects.js`
